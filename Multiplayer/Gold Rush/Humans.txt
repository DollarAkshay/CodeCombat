// This code runs once per frame. Choose where to move to grab gold!
// First player to 150 gold wins.

// This is an example of grabbing the 0th coin from the items array.

//Function to return coin vector from current position
function coinVector(coin, player,opp){
    var dist = player.distance(coin);
    var snatch = Math.sqrt((opp.pos.x-coin.pos.x)*(opp.pos.x-coin.pos.x) + 
                           (opp.pos.y-coin.pos.y)*(opp.pos.y-coin.pos.y));
    var lost = snatch<dist?0.5:1;
    var vector = new Vector(coin.pos.x-player.pos.x,coin.pos.y-player.pos.y);
    vector = Vector.multiply(vector, 
      lost*Math.pow(coin.bountyGold,1) * 1000/(Math.pow(dist,3)));
    return vector;
}

var coins = this.getItems();
var opp = this.getNearestEnemy();
var px=this.pos.x,py=this.pos.y;
var ex=opp.pos.x,ey=opp.pos.y;
var sum = new Vector(0,0);

//Resultant Vector
if(coins[0]){
for(var i=0; i<coins.length; i++)
    sum = Vector.add(sum, coinVector(coins[i],this,opp) );
    if(sum.magnitude()<10)
sum = Vector.multiply(Vector.normalize(sum),10);
}
this.move({x: px+sum.x, y: py+sum.y});

//Gets the new Coins generated
if (typeof this.prevCoins === 'undefined'){
	this.prevCoins=coins.slice(0);
}
var CurrentCoinsHash = {};
this.prevCoins.forEach(function(obj){CurrentCoinsHash[obj.id]=obj;});
var newCoins = coins.filter(function(obj){ return !(obj.id in CurrentCoinsHash);});

if(newCoins.length>0)
    this.prevCoins=coins.slice(0);
    
//Terrify is Opponent is winning
if(opp.gold>100 && !this.getCooldown('terrify'))
    this.terrify();


